name: 'Upload Compressed Artifacts'
description: 'Compresses and uploads files or directories as artifacts via GitHub Actions cache'
inputs:
  paths:
    description: 'Paths to files or directories to compress and upload (recursive)'
  output:
    description: 'Output filename for the compressed archive'
  name:
    description: 'Artifact name for identification (used in cache key)'
  cache_key_prefix:
    description: 'Prefix for the cache key'
    default: 'build-artifacts'
  retention_days:
    description: 'Number of days to retain the artifacts'
    default: '90'
runs:
  using: 'composite'
  steps:
    - name: ü§ê Create Archive (Linux or Mac)
      run: zip -q -r ${{ inputs.output }} ${{ inputs.paths }}
      shell: bash
      if: ${{ runner.os != 'Windows' }}

    - name: ü§ê Create Archive (Windows)
      run: 7z a -tzip -r ${{ inputs.output }} ${{ inputs.paths }}
      shell: bash
      if: ${{ runner.os == 'Windows' }}

    # Use GitHub Actions cache exclusively for all artifact storage
    - name: üóÑÔ∏è Cache Artifact
      uses: actions/cache@v4
      with:
        path: ${{ inputs.output }}
        # Create a hash-based key including the runner OS, the workflow run ID, and a hash of the files
        key: ${{ inputs.cache_key_prefix }}-${{ inputs.name }}-${{ runner.os }}-${{ github.run_id }}-${{ hashFiles(inputs.paths) }}
        # Provide additional restore keys to find older caches if exact match not found
        restore-keys: |
          ${{ inputs.cache_key_prefix }}-${{ inputs.name }}-${{ runner.os }}-
